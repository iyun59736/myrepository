<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>생윤퀴즈</title>

  <style>
    body {
      font-family: 'Noto Sans KR', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #f2f4f8;
      margin: 0;
    }

    .container {
      background: white;
      padding: 30px 40px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 800px;
      text-align: center;
    }

    #questionNumber { font-weight: bold; margin-bottom: 10px; color: #555; }
    #question { font-size: 20px; margin-bottom: 10px; }
    #explanation { font-size: 14px; color: #555; margin-bottom: 20px; }

    #options {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    #options button {
      width: 100%;
      background: #e5e7eb;
      color: #111;
      font-size: 16px;
    }

    #options button:hover { background: #d1d5db; }

    #resultScreen { display: none; }
    #resultText { font-size: 28px; font-weight: bold; margin-bottom: 20px; }

    button {
      margin-top: 20px;
      padding: 12px 25px;
      border: none;
      border-radius: 12px;
      background: #4f46e5;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }

    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    .file-list {
      text-align: left;
      margin-top: 20px;
      margin-bottom: 20px;
      font-size: 18px;
    }

    .file-list label {
      display: block;
      margin: 8px 0;
      cursor: pointer;
    }
  </style>
</head>

<body>

  <!-- 시작 화면 -->
  <div class="container" id="startScreen">
    <h1>범위 선택</h1>
    <p>출제 범위를 선택하시오.</p>

    <div id="fileSelect" class="file-list"></div>

    <button id="startBtn" disabled>시작하기</button>
  </div>

  <!-- 퀴즈 화면 -->
  <div class="container" id="quizContainer" style="display:none;">
    <h1>퀴즈</h1>

    <div id="quiz">
      <div id="questionNumber"></div>
      <div id="question"></div>
      <div id="explanation"></div>
      <div id="options"></div>
      <button onclick="nextStep()">다음</button>
    </div>

    <div id="resultScreen">
      <div id="resultText"></div>
      <button onclick="location.reload()">처음으로</button>
    </div>
  </div>

  <!-- 전역 등록 배열 -->
  <script>
    const quizFiles = [];
  </script>

  <!-- 문제 파일 ------------------------------------------------------------>
  <script src="윤리학.js"></script>
  <script src="유교.js"></script>
  <script src="도교.js"></script>
  <script src="불교.js"></script>

  <!-- 퀴즈 로직 -->
  <script>
    let allData = [];
    let currentQuestion = 0;
    let correctCount = 0;
    let state = "answer";

    const fileSelectDiv = document.getElementById("fileSelect");
    const startBtn = document.getElementById("startBtn");

    // 체크박스 자동 생성
    quizFiles.forEach((file, index) => {
      const label = document.createElement("label");

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = true;
      checkbox.dataset.index = index;
      checkbox.onchange = updateStartButton;

      label.appendChild(checkbox);
      label.append(" " + file.name);

      fileSelectDiv.appendChild(label);
    });

    updateStartButton();

    function updateStartButton() {
      const checked = document.querySelectorAll("#fileSelect input:checked");
      startBtn.disabled = checked.length === 0;
    }

    // 시작 버튼 클릭
    startBtn.onclick = () => {
      const checked = document.querySelectorAll("#fileSelect input:checked");
      allData = [];

      checked.forEach(cb => {
        const idx = cb.dataset.index;
        allData = allData.concat(quizFiles[idx].data);
      });

      shuffleArray(allData);

      document.getElementById("startScreen").style.display = "none";
      document.getElementById("quizContainer").style.display = "block";

      showQuestion();
    };

    // 퀴즈 로직
    function showQuestion() {
      const q = allData[currentQuestion];

      const options = [
        { text: q.correct, isCorrect: true },
        { text: q.wrong1, isCorrect: false },
        { text: q.wrong2, isCorrect: false },
        { text: q.wrong3, isCorrect: false }
      ];
      shuffleArray(options);

      document.getElementById("questionNumber").innerText =
        `${currentQuestion + 1} / ${allData.length}`;
      document.getElementById("question").innerText = q.question;
      document.getElementById("explanation").innerText = "";

      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";

      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.innerText = opt.text;

        btn.onclick = () => {
          if (state !== "answer") return;

          const buttons = optionsDiv.querySelectorAll("button");
          buttons.forEach(b => {
            if (b.innerText === q.correct) b.style.background = "#86efac";
            else if (b.innerText === opt.text) b.style.background = "#fca5a5";
          });

          if (opt.isCorrect) correctCount++;
          document.getElementById("explanation").innerText = q.explanation;
          state = "next";
        };

        optionsDiv.appendChild(btn);
      });
    }

    function nextStep() {
      if (state === "answer") return;

      currentQuestion++;
      if (currentQuestion >= allData.length) {
        document.getElementById("quiz").style.display = "none";
        document.getElementById("resultScreen").style.display = "block";
        document.getElementById("resultText").innerText =
          `${correctCount} / ${allData.length}`;
        return;
      }

      state = "answer";
      showQuestion();
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }
  </script>

</body>
</html>