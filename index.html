<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>수행평가 일정 안내</title>
</head>
<body>
  <center><h1>2-4반 수행평가 일정 안내 모음</h1></center>
  <ul id="result"></ul>

  <script>
    const sheetID = "1DdlZ6NbsDBzKhGATyxCVdrU5bCqKPPEDiO4CUGpheGU";
    const query = encodeURIComponent("SELECT A, B, C OFFSET 1");
    const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tq=${query}`;

    fetch(url)
      .then(res => res.text())
      .then(rep => {
        const data = JSON.parse(rep.substring(47).slice(0, -2));
        const rows = data.table.rows;
        const result = document.getElementById("result");

        const today = new Date();
        today.setHours(0, 0, 0, 0); // 오늘 날짜 기준 비교

        rows.forEach(row => {
          const subject = row.c[0]?.v || "(과목 없음)";
          const rawDate = row.c[1]?.v;
          const type = row.c[2]?.v || "(유형 없음)";

          // HTML 요소 만들기
          const li = document.createElement("li");

          // 날짜가 있으면 포맷팅
          let dateText = "날짜 없음";
          let isClose = false;

          if (rawDate) {
            const dateObj = new Date(rawDate);
            const yyyy = dateObj.getFullYear();
            const mm = String(dateObj.getMonth() + 1).padStart(2, "0");
            const dd = String(dateObj.getDate()).padStart(2, "0");
            dateText = `${yyyy}.${mm}.${dd}`;

            // 3일 이내면 붉게 표시
            const diff = (dateObj - today) / (1000 * 60 * 60 * 24);
            if (diff >= 0 && diff <= 3) {
              li.style.color = "red";
            }
          }

          li.textContent = `${subject} ${dateText} ${type}`;
          result.appendChild(li);
        });
      })
      .catch(err => {
        document.getElementById("result").textContent = "데이터를 불러올 수 없습니다.";
        console.error("오류:", err);
      });
  </script>
</body>
</html>
