<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>단어 시험</title>
</head>
<body>
  <h1>단어 시험</h1>

  <!-- 그룹 선택 영역 -->
  <div id="groupSelection"></div>
  <button onclick="startQuiz()">선택한 그룹으로 시작</button>

  <div id="question"></div>
  <div id="choices"></div>
  <div id="result"></div>
  <button onclick="nextQuestion()">다음 문제</button>

  <!-- JS 코드 직접 작성 -->
  <script>
    let words = [];
    let filteredWords = [];
    let currentWord;

    // 구글 시트 CSV 가져오기
    async function loadData() {
      const url = "https://docs.google.com/spreadsheets/d/1DdlZ6NbsDBzKhGATyxCVdrU5bCqKPPEDiO4CUGpheGU/export?format=csv"; 
      const response = await fetch(url);
      const text = await response.text();
      const rows = text.split("\n").map(r => r.split(","));
      // A열: 영어, B열: 뜻, C열: 그룹 이름(텍스트)
      words = rows.map(r => ({word: r[0], meaning: r[1], group: r[2]}));

      // 그룹 목록 추출
      const groups = [...new Set(words.map(w => w.group))];
      const groupDiv = document.getElementById("groupSelection");
      groups.forEach(g => {
        const label = document.createElement("label");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.value = g;
        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(" " + g));
        groupDiv.appendChild(label);
        groupDiv.appendChild(document.createElement("br"));
      });
    }

    function startQuiz() {
      const selectedGroups = Array.from(document.querySelectorAll("#groupSelection input:checked"))
                                 .map(cb => cb.value);
      filteredWords = words.filter(w => selectedGroups.includes(w.group));
      if (filteredWords.length === 0) {
        alert("선택한 그룹에 단어가 없습니다!");
        return;
      }
      nextQuestion();
    }

    function nextQuestion() {
      document.getElementById("result").innerText = "";
      currentWord = filteredWords[Math.floor(Math.random() * filteredWords.length)];
      document.getElementById("question").innerText = `단어: ${currentWord.word}`;

      // 정답 + 오답 3개 뽑기
      let options = [currentWord.meaning];
      while (options.length < 4) {
        let randomMeaning = filteredWords[Math.floor(Math.random() * filteredWords.length)].meaning;
        if (!options.includes(randomMeaning)) {
          options.push(randomMeaning);
        }
      }

      // 보기 섞기
      options = options.sort(() => Math.random() - 0.5);

      // 보기 출력
      const choicesDiv = document.getElementById("choices");
      choicesDiv.innerHTML = "";
      options.forEach(opt => {
        const btn = document.createElement("button");
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(opt);
        choicesDiv.appendChild(btn);
      });
    }

    function checkAnswer(selected) {
      if (selected === currentWord.meaning) {
        document.getElementById("result").innerText = "✅ 정답!";
      } else {
        document.getElementById("result").innerText = `❌ 오답! 정답은 ${currentWord.meaning}`;
      }
    }

    loadData();
  </script>
</body>
</html>
